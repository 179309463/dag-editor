<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="height: 100%;border: none;padding: 0px;margin: 0px;">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=10; IE=9; IE=8; IE=7;  IE=EDGE"/>
	<meta content="JobComposer" name="keywords" />
	<meta content="JobComposer" name="description" />
	<meta name="generator" content="JobComposer"/>
	<link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />
	<title>Demo-Malakas</title>
    
    <script src="go.js"></script>
    <script src="../extensions/DataInspector.js"></script>
    <script src="../extensions/Robot.js"></script>
	
	<link href="../assets/css/goSamples.css" rel="stylesheet" type="text/css" />  <!-- you don't need to use this -->
	<script src="goSamples.js"></script>  <!-- this is only for the GoJS Samples framework -->
	<!-- <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" /> -->
	<style type="text/css">
	</style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main" style="padding:5px;">
                <div id="myDiagramDiv" style="border: solid 1px #DAE4E4; width:100%; height:500px;background-color: #DAE4E4;"></div>
                <div>
                    <div id ="diagramEventsMsg"></div>
                  <button onclick="layout()">Re-layout Diagram</button>
                  <button id="SaveButton" onclick="save()">Save</button>
                  <button onclick="load()">Load</button><br />
                  <textarea id="mySavedModel" style="width:100%;height:300px">
{ "class": "go.GraphLinksModel",
  "nodeDataArray": [ 
{"category":"CommentText", "key":-12, "text":"附加信息：\nOmais_SQL: 10.6.31.127 10010 omais omaisxxx\nHigos_SQL: 10.6.31.128 10011 higos higosxxx\nEtau_SQL:10.6.31.129 10012 etau etauxxx\nHato_SQL:10.6.31.130 10013 hato hatoxxx\nHagibis_SQL:10.6.31.131 10014 hagibis hagibisxxx\nBailu_SQL:\nChoi_Wan_SQL:\nNangka_SQL:\nMelor_SQL:\nFaxai_SQL:\nNari_SQL:\n", "loc":"1235.7958532592984 1789.603557232097"},
{"category":"HostService", "text":"LVS\nAPI域名：nscloud.api.nsfocus.com\n运维门户：sop.intra.nsfocus.com\n客户门户：cloud.nsfocus.com\n第三方接入：3rd.cloud.nsfocus.com", "key":-13, "loc":"-972.8451401213576 690.6254254798965", "group":-82},
{"category":"HostService", "text":"Nginx\n10.241.24.3", "key":-14, "group":-16, "loc":"-508.5409422921199 695.5825279873902"},
{"category":"HostService", "text":"Nginx\n10.241.24.4", "key":-15, "group":-16, "loc":"-505.5560991759763 765.1655919288129"},
{"text":"WebProxy", "isGroup":true, "color":"green", "key":-16, "group":-82},
{"category":"HostService", "text":"pub-nfs\n10.7.4.20:/nfsdata", "key":-17, "loc":"1244.9906965645935 1223.8661890773255", "group":-76},
{"category":"HostService", "text":"pub-redis\n10.6.24.89:6379\nbef66a123cb7c17b2fda580b4690cbcdd502a827", "key":-18, "loc":"1239.1789886607453 994.6305086700617", "group":-76},
{"text":"MySQL", "isGroup":true, "color":"green", "key":-19, "group":-76},
{"category":"HostService", "text":"mysql-master\n10.6.31.234", "key":-20, "group":-19, "loc":"1247.843177842012 1129.2495224106588"},
{"category":"HostService", "text":"mysql-slave\n10.6.31.234", "key":-21, "group":-19, "loc":"1474.0016708888238 1129.2495224106588"},
{"category":"HostService", "text":"研发区\nRSync文件同步服务器\n10.6.24.65", "key":-11, "loc":"-555.6624846716509 1026.0718794084705"},
{"category":"HostService", "text":"malakas\n10.6.24.9", "key":-22, "loc":"970.5572611226507 1630.5796108495047", "group":-80},
{"category":"HostService", "text":"3a-redis\n10.6.24.90:6379\n050d1f2ef4876e415b2520c321b503343a69400d", "key":-23, "loc":"408.0190130843333 187.57098423107078", "group":-75},
{"category":"HostService", "text":"Atsani-api\n10.6.24.34", "key":-24, "group":-26, "loc":"33.44688533671333 195.14628041376386"},
{"category":"HostService", "text":"Atsani-api\n10.6.24.35", "key":-25, "group":-26, "loc":"184.16730363580237 195.14628041376386"},
{"text":"Atsani-API", "isGroup":true, "color":"green", "key":-26, "group":-79},
{"category":"HostService", "text":"Atsani-LDAP\n10.6.31.2", "key":-27, "loc":"405.78583137723837 115.27806351064866", "group":-75},
{"category":"HostService", "text":"Krosa-web\n10.6.24.36", "key":-28, "group":-30, "loc":"125.31385097489942 332.73309363790565"},
{"category":"HostService", "text":"Krosa-web\n10.6.24.37", "key":-29, "group":-30, "loc":"277.0273875601214 332.73309363790565"},
{"text":"Krosa-用户门户", "isGroup":true, "color":"green", "key":-30, "group":-84},
{"text":"Tembin-运维门户", "isGroup":true, "color":"green", "key":-31, "group":-84},
{"category":"HostService", "text":"Tembin-web\n10.6.24.38", "key":-32, "group":-31, "loc":"193.70854049510154 445.03846184056"},
{"category":"HostService", "text":"Tembin-web\n10.6.24.39", "key":-33, "group":-31, "loc":"356.82947148950336 445.03846184056"},
{"text":"Omais-服务管理", "isGroup":true, "color":"green", "key":-34, "group":-84},
{"category":"HostService", "text":"Omais-API\n10.6.24.40", "key":-35, "group":-34, "loc":"258.71345033920346 683.3990655879478"},
{"category":"HostService", "text":"Omais-API\n10.6.24.41", "key":-36, "group":-34, "loc":"411.438354722277 683.3990655879478"},
{"text":"Higos-客户管理", "isGroup":true, "color":"green", "key":-37, "group":-84},
{"category":"HostService", "text":"Higos-API\n10.6.24.42", "key":-38, "group":-37, "loc":"255.94876893200762 563.3348717527869"},
{"category":"HostService", "text":"Higos-API\n10.6.24.43", "key":-39, "group":-37, "loc":"406.66918723109717 563.3348717527869"},
{"category":"HostService", "text":"Etau-API\n10.6.24.44", "key":-40, "group":-42, "loc":"148.2855927464858 847.4115074550544"},
{"category":"HostService", "text":"Etau-API\n10.6.24.45", "key":-41, "group":-42, "loc":"299.00601104557484 847.4115074550544"},
{"text":"Etau-API", "isGroup":true, "color":"green", "key":-42, "group":-78},
{"category":"HostService", "text":"Etau-Cert\n192.168.255.67:80", "key":-43, "loc":"526.3029136340931 816.5579541059423", "group":-74},
{"category":"HostService", "text":"Etau-Hive\n10.6.31.239:8084:hive", "key":-44, "loc":"529.2559130669082 897.7452789978923", "group":-74},
{"category":"HostService", "text":"Etau-NAPI\n10.7.53.20", "key":-45, "loc":"763.7437921030975 814.6632708927734", "group":-74},
{"category":"HostService", "text":"Hato-API\n10.6.24.46", "key":-46, "group":-48, "loc":"142.3676121140777 1148.7303745076192"},
{"category":"HostService", "text":"Hato-API\n10.6.24.47", "key":-47, "group":-48, "loc":"308.0880304131667 1147.0637078409532"},
{"text":"Hato-事件管理", "isGroup":true, "color":"green", "key":-48, "group":-84},
{"category":"HostService", "text":"Hagibis-web/api\n10.6.24.48", "key":-49, "group":-51, "loc":"140.2477774480298 1021.4160699491374"},
{"category":"HostService", "text":"Hagibis-web/api\n10.6.24.49", "key":-50, "group":-51, "loc":"365.53164179204106 1019.7494032824698"},
{"text":"Hagibis-对外通知", "isGroup":true, "color":"green", "key":-51, "group":-84},
{"category":"HostService", "text":"Bailu-web/api\n10.6.24.50", "key":-52, "group":-54, "loc":"155.45432293316608 1332.4696296000868"},
{"category":"HostService", "text":"Bailu-web/api\n10.6.24.50", "key":-53, "group":-54, "loc":"330.00082155452066 1332.4696296000868"},
{"text":"Bailu-API/Web", "isGroup":true, "color":"green", "key":-54, "group":-77},
{"category":"HostService", "text":"Bailu-Worker\n10.5.0.230", "key":-55, "loc":"534.2346572663491 1332.500850744908", "group":-77},
{"category":"HostService", "text":"Choi_Wan-web/api\n10.6.24.52", "key":-56, "group":-58, "loc":"154.73324830039587 1620.8850657466426"},
{"category":"HostService", "text":"Choi_Wan-web/api\n10.6.24.52", "key":-57, "group":-58, "loc":"374.2168044168675 1620.8850657466426"},
{"text":"Choi_Wan-API/Web", "isGroup":true, "color":"green", "key":-58, "group":-81},
{"category":"HostService", "text":"Choi_Wan-redis\n10.6.24.60", "key":-59, "loc":"718.9806008197028 1543.7832694324932", "group":-80},
{"category":"HostService", "text":"Choi_Wan-rabbitmq\n10.6.24.62", "key":-60, "loc":"721.679571791716 1628.8761171532506", "group":-80},
{"category":"HostService", "text":"Choi_Wan-worker\n10.6.24.58", "key":-61, "loc":"937.2426414816484 1544.8153392683682", "group":-80},
{"category":"HostService", "text":"Nangka-api\n10.6.24.91", "key":-62, "group":-64, "loc":"157.36361402831756 1813.4688083275594"},
{"category":"HostService", "text":"Nangka-api\n10.6.24.91", "key":-63, "group":-64, "loc":"315.3184073274068 1813.4688083275594"},
{"text":"Nangka-订单管理", "isGroup":true, "color":"green", "key":-64, "group":-83},
{"text":"Melor-企业认证", "isGroup":true, "color":"green", "key":-65, "group":-83},
{"category":"HostService", "text":"Melor-api\n10.6.24.16", "key":-66, "group":-65, "loc":"159.8171167481497 1920.047480781648"},
{"category":"HostService", "text":"Melor-api\n10.6.24.16", "key":-67, "group":-65, "loc":"310.53753504723926 1920.047480781648"},
{"category":"HostService", "text":"Faxi-api\n10.6.24.14", "key":-68, "group":-70, "loc":"156.23873104077356 2037.75683673666"},
{"category":"HostService", "text":"Faxi-api\n10.6.24.14", "key":-69, "group":-70, "loc":"306.9591493398618 2037.75683673666"},
{"text":"Faxi-发票管理", "isGroup":true, "color":"green", "key":-70, "group":-83},
{"category":"HostService", "text":"Nari-api\n10.6.24.12", "key":-71, "group":-73, "loc":"160.24088893408776 2144.495466521777"},
{"category":"HostService", "text":"Nari-api\n10.6.24.12", "key":-72, "group":-73, "loc":"310.9613072331775 2144.495466521777"},
{"text":"Nari-支付管理", "isGroup":true, "color":"green", "key":-73, "group":-83},
{"text":"Etau-deps", "isGroup":true, "color":"green", "key":-74, "group":-78},
{"text":"Atsani-DB", "isGroup":true, "color":"green", "key":-75, "group":-79},
{"text":"基础服务-数据库", "isGroup":true, "color":"green", "key":-76},
{"text":"Bailu-报表管理", "isGroup":true, "color":"green", "key":-77, "group":-84},
{"text":"Etau-设备管理", "isGroup":true, "color":"green", "key":-78, "group":-84},
{"text":"Atsani-AAA用户权限管理", "isGroup":true, "color":"green", "key":-79, "group":-84},
{"text":"Choi_Wan-deps", "isGroup":true, "color":"green", "key":-80, "group":-81},
{"text":"Choi_Wan-任务调度", "isGroup":true, "color":"green", "key":-81, "group":-84},
{"text":"DMZ区", "isGroup":true, "color":"green", "key":-82},
{"text":"Optional_Service", "isGroup":true, "color":"green", "key":-83, "group":-84},
{"text":"研发区", "isGroup":true, "color":"green", "key":-84},
{"category":"HostService", "text":"LogProxy\n10.6.31.3", "key":-85, "loc":"1238.7406965645957 1340.116189077326", "group":-87},
{"category":"HostService", "text":"分布式\n10.6.31.239:8084:hive", "key":-86, "loc":"1423.7406965645941 1340.116189077326", "group":-87},
{"category":"HostService", "text":"pub-nfs\n10.7.4.20:/nfsdata", "key":-88, "loc":"1241.240696564594 1427.6161890773258", "group":-87},
{"text":"基础服务-分布式存储、日志处理", "isGroup":true, "color":"red", "key":-87}
 ],
  "linkDataArray": [ 
{"from":-13, "to":-16, "points":[-588.9384425452575,757.5789076460898,-519.0409422921201,757.5592049378972]},
{"from":-26, "to":-23, "points":[314.88771096082013,225.0478397600453,408.0190240584053,225.66488465299182]},
{"from":-53, "to":-55, "points":[484.5473201699017,1361.9500877387638,534.2346572723242,1361.9577685727463]},
{"from":-58, "to":-59, "points":[605.7610329685552,1610.3850657466419,718.9870848448335,1591.9707781864136]},
{"from":-16, "to":-30, "points":[-339.85307589641843,706.8461163480245,188.4595218811238,407.95287411961215]},
{"from":-11, "to":-16, "points":[-428.4907345548053,1026.0718825786932,-429.15197179761174,840.3853724105193]},
{"from":-16, "to":-26, "points":[-346.8842544291081,685.0825279873902,125.71011132575954,270.36606089547024]},
{"from":-16, "to":-31, "points":[-339.85307589641843,724.9044675629442,222.06390078192518,520.2582423222664]},
{"from":-16, "to":-34, "points":[-339.85307589641843,752.5076993617274,248.21345033920352,719.5169625524616]},
{"from":-16, "to":-37, "points":[-339.85307589641843,739.555540894205,245.44876893200774,622.1056672525037]},
{"from":-16, "to":-42, "points":[-339.85307589641843,772.0019152707112,137.78559274648575,849.1328026890066]},
{"from":-16, "to":-48, "points":[-339.85307589641843,809.034995747783,229.9331340521142,1136.5637078409527]},
{"from":-16, "to":-51, "points":[-339.85307589641843,790.890858158104,246.64016049740462,1009.2494032824698]},
{"from":-16, "to":-54, "points":[-339.85307589641843,828.7508339365355,276.0153708098919,1318.2954939513038]},
{"from":-16, "to":-58, "points":[-354.377695792655,840.3853724105193,331.8235101347567,1599.5788157466418]},
{"from":-42, "to":-74, "points":[442.34298397870464,871.4539569328224,526.306247305716,861.7094270011753]},
{"from":-16, "to":-83, "points":[-380.07027402203374,840.3853724105193,181.14222295183077,1782.0688083275584]},
{"from":-21, "to":-20, "points":[1474.0016708888227,1161.6094126515127,1418.3563207504765,1161.6094126515127]},
{"from":-84, "to":-76, "points":[1181.1658643461676,1139.5736695685798,1226.843177842012,1139.0729307287402]},
{"from":-84, "to":-87, "points":[1181.1658643461674,1326.2101343353308,1228.2406965645944,1340.5952604688568]}
 ]}
                </textarea>
                </div>
                
                
                
                
            </div>


        </div>
    </div>
    <!-- <div style="width:100%; white-space:nowrap;">
        <span style="display: inline-block; vertical-align: top; padding: 5px; width:10%">
            <div id="palettex" style="background-color: Snow; border: solid 1px gray; height: 800px"></div>
        </span>
        <span style="display: inline-block; vertical-align: top; padding: 5px; width:90%">
            <div id="myDiagramDivx" style="border: solid 1px black; width:100%; height:800px;background-color: #DAE4E4;"></div>
        </span>
        
        <div class="push" style="height:130px;clear: both;"></div>
    </div> -->
    <!-- <div style="min-height:100%;height: auto !important;height: 100%;margin: 0 auto -130px;">
        <div id="myDiagramDiv" style="border: solid 1px black; width:1000px; height:500px;background-color: #DAE4E4;"></div>
        <div class="push" style="height:130px;clear: both;"></div>
    </div> -->
	<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
            editorInit();
			//layout();
			load();
		});
		
		function layout() {
    myDiagram.layoutDiagram(true);
  }
  // Show the diagram's model in JSON format
  function save() {
    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
    myDiagram.isModified = false;
  }
  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
  }
  function editorInit() {
        var robot;  // this global variable will hold an instance of the Robot class for myDiagram
        var global_conf = {};
        global_conf["description"] = "Input Some Description ...";
        global_conf["global_envs"] = [
            {"Param1":"123456"},
            {"Param2":"654321"},
            {"Param3":"abcd"},
            {"Param4":"dcba"}
        ];
        //var html = '';
        //$("#id_Global_Configurations").html();
        //$("#id_Global_Configurations").append(html);

        var GO = go.GraphObject.make;  // for conciseness in defining templates

    var yellowgrad = GO(go.Brush, "Linear", { 0: "rgb(254, 201, 0)", 1: "rgb(254, 162, 0)" });
    var greengrad = GO(go.Brush, "Linear", { 0: "#98FB98", 1: "#9ACD32" });
    var bluegrad = GO(go.Brush, "Linear", { 0: "#B0E0E6", 1: "#87CEEB" });
    var redgrad = GO(go.Brush, "Linear", { 0: "#C45245", 1: "#7D180C" });
    var whitegrad = GO(go.Brush, "Linear", { 0: "#F0F8FF", 1: "#E6E6FA" });

    var bigfont = "normal 16pt Helvetica, Arial, sans-serif";
    var smallfont = "normal 16pt Helvetica, Arial, sans-serif";

    // Common text styling
    function textStyle() {
      return {
        margin: 6,
        //wrap: go.TextBlock.WrapFit,
        //textAlign: "center",
        editable: true,
        font: smallfont,
        isMultiline: true  // don't allow newlines in text
      }
    }

    myDiagram =
      GO(go.Diagram, "myDiagramDiv",
        {
          // have mouse wheel events zoom in and out instead of scroll up and down
          //"toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
          allowDrop: true,  // support drag-and-drop from the Palette
          //initialAutoScale: go.Diagram.Uniform,
		  scale: 0.8,
          "linkingTool.direction": go.LinkingTool.ForwardsOnly,
          initialContentAlignment: go.Spot.Center,
          layout: GO(go.LayeredDigraphLayout, { isInitial: false, isOngoing: false, layerSpacing: 50 }),
          // allow Ctrl-G to call groupSelection()
          "commandHandler.archetypeGroupData": { text: "Group", isGroup: true, color: "red" },
          "undoManager.isEnabled": true
        });

    // when the document is modified, add a "*" to the title and enable the "Save" button
    myDiagram.addDiagramListener("Modified", function(e) {
      var button = document.getElementById("SaveButton");
      if (button) button.disabled = !myDiagram.isModified;
      var idx = document.title.indexOf("*");
      if (myDiagram.isModified) {
        if (idx < 0) document.title += "*";
      } else {
        if (idx >= 0) document.title = document.title.substr(0, idx);
      }
    });

    var defaultAdornment =
      GO(go.Adornment, "Spot",
        GO(go.Panel, "Auto",
          GO(go.Shape, { fill: null, stroke: "dodgerblue", strokeWidth: 4 }),
          GO(go.Placeholder)),
        // the button to create a "next" node, at the top-right corner
        GO("Button",
          { alignment: go.Spot.TopRight,
            click: addNodeAndLink },  // this function is defined below
          new go.Binding("visible", "", function(a) { return !a.diagram.isReadOnly; }).ofObject(),
          GO(go.Shape, "PlusLine", { desiredSize: new go.Size(6, 6) })
        )
      );

    // define the Node template
    myDiagram.nodeTemplate =
      GO(go.Node, "Auto",
        { selectionAdornmentTemplate: defaultAdornment },
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // define the node's outer shape, which will surround the TextBlock
        GO(go.Shape, "Rectangle",
          { fill: yellowgrad, stroke: "black",
            portId: "", fromLinkable: true, toLinkable: true, cursor: "pointer",
            toEndSegmentLength: 50, fromEndSegmentLength: 40 }),
        GO(go.TextBlock, "Page",
          { margin: 6,
            font: bigfont,
            editable: true },
          new go.Binding("text", "text").makeTwoWay()));

	myDiagram.nodeTemplateMap.add("Default",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // new go.Binding("text", "text"),
        GO(go.Shape, "RoundedRectangle",{ 
          fill: "#FFFFFF",
          portId: "", cursor: "pointer",  // the Shape is the port, not the whole Node
        // allow all kinds of links from and to this port
        fromLinkable: true, fromLinkableSelfNode: false, fromLinkableDuplicates: true,
        toLinkable: true, toLinkableSelfNode: false, toLinkableDuplicates: true
        }),
        GO(go.Panel, "Horizontal",
            GO(go.Picture,
                      // Pictures should normally have an explicit width and height.
                      // This picture has a red background, only visible when there is no source set
                      // or when the image is partially transparent.
                      { source:"/static/images/resources/host.jpg", margin: 2, width: 20, height: 20}
            ),
            GO(go.TextBlock, "HostService", textStyle(), new go.Binding("text", "text").makeTwoWay()
            )
        ), // end Horizontal Panel
        GO(go.TextBlock,
              new go.Binding("text", "instances"),
              { alignment: go.Spot.TopRight, //background: "lightgreen", 
              stroke: "yellowgrad", 
              font: "bold 12pt", editable:false } 
        )
        ));
	
    myDiagram.nodeTemplateMap.add("HostService",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // new go.Binding("text", "text"),
        GO(go.Shape, "RoundedRectangle",{ 
          fill: "#FFFFFF",
          portId: "", cursor: "pointer",  // the Shape is the port, not the whole Node
        // allow all kinds of links from and to this port
        fromLinkable: true, fromLinkableSelfNode: false, fromLinkableDuplicates: true,
        toLinkable: true, toLinkableSelfNode: false, toLinkableDuplicates: true
        }),
        GO(go.Panel, "Horizontal",
            GO(go.Picture,
                      // Pictures should normally have an explicit width and height.
                      // This picture has a red background, only visible when there is no source set
                      // or when the image is partially transparent.
                      { source:"../resources/host.jpg", margin: 2, width: 20, height: 20}
            ),
            GO(go.TextBlock, "HostService", textStyle(), new go.Binding("text", "text").makeTwoWay()
            )
        ), // end Horizontal Panel
        GO(go.TextBlock,
              new go.Binding("text", "instances"),
              { alignment: go.Spot.TopRight, //background: "lightgreen", 
              stroke: "yellowgrad", 
              font: "bold 12pt", editable:false } 
        )
        ));
        
    myDiagram.nodeTemplateMap.add("DockerService",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // new go.Binding("text", "text"),
        GO(go.Shape, "RoundedRectangle",{ 
          fill: "#FFFFFF",
          portId: "", cursor: "pointer",  // the Shape is the port, not the whole Node
        // allow all kinds of links from and to this port
        fromLinkable: true, fromLinkableSelfNode: false, fromLinkableDuplicates: true,
        toLinkable: true, toLinkableSelfNode: false, toLinkableDuplicates: true
        }),
        GO(go.Panel, "Horizontal",
            GO(go.Picture,
                      // Pictures should normally have an explicit width and height.
                      // This picture has a red background, only visible when there is no source set
                      // or when the image is partially transparent.
                      { source:"/static/images/resources/docker.jpg", margin: 2, width: 20, height: 20}),
            GO(go.TextBlock, "DockerService", textStyle(), new go.Binding("text", "text").makeTwoWay()
              )
        ), // end Horizontal Panel
        GO(go.TextBlock,
              new go.Binding("text", "instances"),
              { alignment: go.Spot.TopRight, //background: "lightgreen", 
              stroke: "yellowgrad", 
              font: "bold 12pt", editable:false } 
        )
        ));
    
    myDiagram.nodeTemplateMap.add("APIProxy",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // new go.Binding("text", "text"),
        GO(go.Shape, "RoundedRectangle",{ 
          fill: "#FFFFFF",
          portId: "", cursor: "pointer",  // the Shape is the port, not the whole Node
        // allow all kinds of links from and to this port
        fromLinkable: true, fromLinkableSelfNode: false, fromLinkableDuplicates: true,
        toLinkable: true, toLinkableSelfNode: false, toLinkableDuplicates: true
        }),
        GO(go.Panel, "Horizontal",
            GO(go.Picture,
                      // Pictures should normally have an explicit width and height.
                      // This picture has a red background, only visible when there is no source set
                      // or when the image is partially transparent.
                      { source:"/static/images/resources/proxy.jpg", margin: 2, width: 20, height: 20}),
            GO(go.TextBlock, "APIProxy", textStyle(), new go.Binding("text", "text").makeTwoWay()
              )
        ), // end Horizontal Panel
        GO(go.TextBlock,
              new go.Binding("text", "instances"),
              { alignment: go.Spot.TopRight, //background: "lightgreen", 
              stroke: "yellowgrad", 
              font: "bold 12pt", editable:false } 
        )
        ));
    
    myDiagram.nodeTemplateMap.add("VirtualNode",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // new go.Binding("text", "text"),
        GO(go.Shape, "RoundedRectangle",{ 
          fill: "#FFFFFF",
          portId: "", cursor: "pointer",  // the Shape is the port, not the whole Node
        // allow all kinds of links from and to this port
        fromLinkable: true, fromLinkableSelfNode: false, fromLinkableDuplicates: true,
        toLinkable: true, toLinkableSelfNode: false, toLinkableDuplicates: true
        }),
        GO(go.Panel, "Horizontal",
            GO(go.Picture,
                      // Pictures should normally have an explicit width and height.
                      // This picture has a red background, only visible when there is no source set
                      // or when the image is partially transparent.
                      { source:"/static/images/resources/vnode.jpg", margin: 2, width: 20, height: 20}),
            GO(go.TextBlock, "VirtualNode", textStyle(), new go.Binding("text", "text").makeTwoWay()
              )
        ), // end Horizontal Panel
        GO(go.TextBlock,
              new go.Binding("text", "instances"),
              { alignment: go.Spot.TopRight, //background: "lightgreen", 
              stroke: "yellowgrad", 
              font: "bold 12pt", editable:false } 
        )
        ));
    
    myDiagram.nodeTemplateMap.add("DesiredEvent",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        GO(go.Shape, "RoundedRectangle",
          { fill: greengrad, portId: "", toLinkable: true, toEndSegmentLength: 50 }),
        GO(go.TextBlock, "Success!", textStyle(),
          new go.Binding("text", "text").makeTwoWay())
        ));

    // Undesired events have a special adornment that allows adding additional "reasons"
    var UndesiredEventAdornment =
      GO(go.Adornment, "Spot",
        GO(go.Panel, "Auto",
          GO(go.Shape, { fill: null, stroke: "dodgerblue", strokeWidth: 4 }),
          GO(go.Placeholder)),
        // the button to create a "next" node, at the top-right corner
        GO("Button",
          { alignment: go.Spot.BottomRight,
            click: addReason },  // this function is defined below
          new go.Binding("visible", "", function(a) { return !a.diagram.isReadOnly; }).ofObject(),
          GO(go.Shape, "TriangleDown", { desiredSize: new go.Size(10, 10) })
        )
      );

    var reasonTemplate = GO(go.Panel, "Horizontal",
      GO(go.TextBlock, "Reason",
        {
          margin: new go.Margin(4,0,0,0),
          maxSize: new go.Size(200, NaN),
          wrap: go.TextBlock.WrapFit,
          stroke: "whitesmoke",
          editable: true,
          font: smallfont
        },
        new go.Binding("text", "text").makeTwoWay())
      );


    myDiagram.nodeTemplateMap.add("UndesiredEvent",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        { selectionAdornmentTemplate: UndesiredEventAdornment },
        GO(go.Shape, "RoundedRectangle",
          { fill: redgrad, portId: "", toLinkable: true, toEndSegmentLength: 50 }),
        GO(go.Panel, "Vertical", {defaultAlignment: go.Spot.TopLeft},

          GO(go.TextBlock, "Drop", textStyle(),
            { stroke: "whitesmoke",
              minSize: new go.Size(80, NaN) },
            new go.Binding("text", "text").makeTwoWay()),

          GO(go.Panel, "Vertical",
            { defaultAlignment: go.Spot.TopLeft,
              itemTemplate: reasonTemplate },
            new go.Binding("itemArray", "reasonsList").makeTwoWay()
          )
        )
        ));

    myDiagram.nodeTemplateMap.add("CommentText",
      GO(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        GO(go.Shape, "Rectangle",
          { portId: "", fill: bluegrad, fromLinkable: false }),
        GO(go.TextBlock, "CommentText",
          { margin: 9,
            maxSize: new go.Size(1000, NaN),
            wrap: go.TextBlock.WrapFit,
            editable: true,
            font: bigfont },
          new go.Binding("text", "text").makeTwoWay())
        // no ports, because no links are allowed to connect with a comment
        ));

    // clicking the button on an UndesiredEvent node inserts a new text object into the panel
    function addReason(e, obj) {
      var adorn = obj.part;
      if (adorn === null) return;
      e.handled = true;
      var arr = adorn.adornedPart.data.reasonsList;
      myDiagram.startTransaction("add reason");
      myDiagram.model.addArrayItem(arr, {});
      myDiagram.commitTransaction("add reason");
    }

    // clicking the button of a default node inserts a new node to the right of the selected node,
    // and adds a link to that new node
    function addNodeAndLink(e, obj) {
      var adorn = obj.part;
      if (adorn === null) return;
      e.handled = true;
      var diagram = adorn.diagram;
      diagram.startTransaction("Add State");
      // get the node data for which the user clicked the button
      var fromNode = adorn.adornedPart;
      var fromData = fromNode.data;
      // create a new "State" data object, positioned off to the right of the adorned Node
      var toData = { text: "new" };
      var p = fromNode.location;
      toData.loc = p.x + 200 + " " + p.y;  // the "loc" property is a string, not a Point object
      // add the new node data to the model
      var model = diagram.model;
      model.addNodeData(toData);
      // create a link data from the old node data to the new node data
      var linkdata = {};
      linkdata[model.linkFromKeyProperty] = model.getKeyForNodeData(fromData);
      linkdata[model.linkToKeyProperty] = model.getKeyForNodeData(toData);
      // and add the link data to the model
      model.addLinkData(linkdata);
      // select the new Node
      var newnode = diagram.findNodeForData(toData);
      diagram.select(newnode);
      diagram.commitTransaction("Add State");
    }

    // replace the default Link template in the linkTemplateMap
    myDiagram.linkTemplate =
      GO(go.Link,  // the whole link panel
        new go.Binding("points").makeTwoWay(),
        { //routing: go.Link.AvoidsNodes,  // may be either Orthogonal or AvoidsNodes
        //curve: go.Link.JumpOver //},
		
        //routing: go.Link.Normal//,
        //curve: go.Link.Bezier//,
        //toShortLength: 8
        },
        //new go.Binding("curviness", "curviness"),
        /*GO(go.Shape,  // the link shape
          { stroke: "black", strokeWidth: 1.0 }),*/
        GO(go.Shape),
		GO(go.Shape, { toArrow: "OpenTriangle", fill: null })
    );
    
    /*myDiagram.linkTemplate =
    GO(go.Link,
      //{ curve: go.Link.Bezier },  // Bezier curve
      GO(go.Shape),
      GO(go.Shape, { toArrow: "Standard" })
    );*/
    
    myDiagram.linkTemplateMap.add("Comment",
      GO(go.Link, { selectable: false },
        GO(go.Shape, { strokeWidth: 2, stroke: "darkgreen" })));
        
    // Groups consist of a title in the color given by the group node data
    // above a translucent gray rectangle surrounding the member parts
    myDiagram.groupTemplate =
      GO(go.Group, "Vertical",
        { selectionObjectName: "PANEL",  // selection handle goes around shape, not label
          ungroupable: true },  // enable Ctrl-Shift-G to ungroup a selected Group
        GO(go.TextBlock,
          {
            font: "bold 16px sans-serif",
            isMultiline: false,  // don't allow newlines in text
            editable: true,  // allow in-place editing by user,
			fromLinkable: true, 
			toLinkable: true
          },
          new go.Binding("text", "text").makeTwoWay(),
          new go.Binding("stroke", "color")),
        GO(go.Panel, "Auto",
          { name: "PANEL" },
          GO(go.Shape, "Rectangle",  // the rectangular shape around the members
            { fill: "rgba(128,128,128,0.2)", stroke: "gray", strokeWidth: 1 , fromLinkable: true, toLinkable: true}),
          GO(go.Placeholder, { padding: 10 })  // represents where the members are
        )
      );


    // a shared Robot that can be used by all commands for this one Diagram
    robot = new Robot(myDiagram);  // defined in Robot.js

    /*var palette =
      GO(go.Palette, "palette",  // create a new Palette in the HTML DIV element "palette"
        {
          // share the template map with the Palette
          nodeTemplateMap: myDiagram.nodeTemplateMap,
          autoScale: go.Diagram.Uniform  // everything always fits in viewport
        });

    palette.model.nodeDataArray = [
      { category: "HostService",text:"HostService", instances:"" },
      { category: "DockerService",text:"DockerService", instances:"" },
      { category: "APIProxy",text:"APIProxy", instances:"" },
      //{ }, // default node
      //{ category: "DesiredEvent" },
      { category: "VirtualNode",text:"VirtualNode", instances:"" },
      //{ category: "UndesiredEvent", reasonsList: [{}] },
      { category: "CommentText"}
    ];*/

    // read in the JSON-format data from the "mySavedModel" element
    
    load();
    //layout();
    
    function showMessage(s) {
    document.getElementById("diagramEventsMsg").textContent = s;
  }
    myDiagram.addDiagramListener("ObjectSingleClicked",
      function(e) {
        var part = e.subject.part;
        //if (!(part instanceof go.Link)) showMessage("Clicked on " + part.data.key);
        showMessage("Clicked on " + part.data.key + " : " + part.data.text);
        $("#pageTab > .active").removeClass('active');
        $("#pageTabContent > .active").removeClass('active');
        $("#id_Node_Configurations_li").addClass("active");
        $("#id_Node_Configurations").addClass("active");
      });
    myDiagram.addDiagramListener("BackgroundSingleClicked",
      function() {
        //var part = e.subject.part;
        //if (!(part instanceof go.Link)) showMessage("Clicked on " + part.data.key);
        showMessage("Clicked on bk");
        $("#pageTab > .active").removeClass('active');
        $("#pageTabContent > .active").removeClass('active');
        $("#id_Global_Configurations_li").addClass("active");
        $("#id_Global_Configurations").addClass("active");
      });
}

	</script>
</body>
</html>
